<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';" /> -->
    <title>Product Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 400px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .product-card {
            margin-bottom: 20px;
        }
        .product-card img {
            max-width: 100%;
            border-radius: 8px;
        }
        .product-details {
            margin-top: 10px;
        }
        .product-details h3 {
            margin: 10px 0;
            font-size: 1.5em;
        }
        .product-details p {
            font-size: 1.2em;
            color: #666;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em;
        }
        .form-group button:hover {
            background-color: #0056b3;
        }
        #click-to-pay-button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="product-card">
            <img src="https://via.placeholder.com/350x150" alt="Product Image">
            <div class="product-details">
                <h3>Product Name</h3>
                <p>$100.00</p>
            </div>
        </div>
        <div class="form-group">
            <button id="add-to-cart">Add to Cart</button>
        </div>
        <div id="click-to-pay-button"></div>
    </div>
    <src-button card-brands ="mastercard"></src-button>

    <script src="https://sandbox.src.mastercard.com/srci/integration/2/lib.js?srcDpaId=01b2280e-6d56-4226-a5c7-a84dce0cd8f3&locale=en_US"></script>
    
    <script>
        var mcCheckoutService = new MastercardCheckoutServices();
        async function initializeMastercardCheckoutServices() {
            try {
                console.log("hdhgzsjkf",mcCheckoutService);
                
                var result = await mcCheckoutService.init(
                    {
                        "srcDpaId": "01b2280e-6d56-4226-a5c7-a84dce0cd8f3", // required
                        "checkoutExperience":"WITHIN_CHECKOUT",
                        "dpaData": { // required
                            "dpaName": "Registered DPA Name"
                        },
                        "dpaTransactionOptions": {
                        "consumerEmailAddressRequested": true,
                        "consumerPhoneNumberRequested": true,
                        "dpaBillingPreference": "FULL",
                        "dpaLocale": "en_US",
                        "paymentOptions": [
                        {
                            "dynamicDataType": "CARD_APPLICATION_CRYPTOGRAM_SHORT_FORM"
                        }
                        ],
                        "transactionAmount": {
                        "transactionAmount": 100,
                        "transactionCurrencyCode": "USD"
                        }
                        },
                        "cardBrands": [ // required
                            "mastercard",
                            // "maestro",
                            // "visa",
                            // "amex",
                            // "discover"
                        ],
                    }

                );
                console.log("1",result);
                

                var result2 = await mcCheckoutService.encryptCard(
                    {  
                        "primaryAccountNumber": "5204731600012796",
                        "panExpirationMonth": "11",
                        "panExpirationYear": "25",
                        "cardSecurityCode": "123",
                        "cardholderFirstName": "Jane",
                        "cardholderLastName": "Doe",
                        "billingAddress": {
                            "name": "Jane Doe",
                            "line1": "Street 1",
                            "line2": "string",
                            "line3": "string",
                            "city": "New York",
                            "state": "NY",
                            "zip": "10009",
                            "countryCode": "US"
                        }
                    }
                );
                
                console.log("2",result2);
                // console.log(Window);
                
                
                var result3 = await mcCheckoutService.checkoutWithNewCard(
                    {
                        "windowRef": window,
                        "encryptedCard": result2.encryptedCard,
                        "cardBrand": "mastercard",
                        "rememberMe": "true",
                        "consumer": {
                            "emailAddress": "test.user@test.com",
                            "mobileNumber": {
                            "phoneNumber": "3470000000",
                            "countryCode": "1"
                            },
                        "firstName": "Test",
                        "lastName": "User"  
                        },
                        "dpaTransactionOptions": {
                            "transactionAmount": {
                            "transactionAmount": 100,
                            "transactionCurrencyCode": "USD"
                            },
                            "dpaBillingPreference": "FULL",
                            "dpaAcceptedBillingCountries": [],
                            "consumerEmailAddressRequested": true,
                            "consumerPhoneNumberRequested": true,
                            "dpaLocale": "en_US",
                            "merchantCategoryCode": "0000",
                            "merchantCountryCode": "US",
                            // "merchantOrderId": "506610rt-6858-4147-9ec2-b030f1337a7d",
                            "threeDsPreference":"NONE",
                            "acquirerMerchantId": "550e8400",
                            // "acquirerBin": "1157111",
                            "paymentOptions": [
                            {
                                "dynamicDataType": "CARD_APPLICATION_CRYPTOGRAM_SHORT_FORM"
                            },
                            ],
                            "authenticationPreferences": {
                            "payloadRequested": "AUTHENTICATED"
                            },
                        }
                        }
                )
                console.log("3",result3);
                alert("Result 3: " + JSON.stringify(result3));
                

                // renderClickToPayButton(result);
            } catch (error) {
                console.log(error);
            }
        }

            initializeMastercardCheckoutServices();


    </script>
</body>
</html>
